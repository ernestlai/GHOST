<!DOCTYPE html>
<meta charset="utf-8">

<link rel="stylesheet" type="text/css" href="css/jquery.contextMenu.css">
<link rel="stylesheet" type="text/css" href="css/bootstrap.css">

<script type="text/javascript" src="js/d3.js"></script>
<script type="text/javascript" src="js/jquery-1.11.3.js"></script>
<script type="text/javascript" src="js/jquery.contextMenu.js"></script>
<script type="text/javascript" src="js/rgbcolor.js"></script>
<script type="text/javascript" src="js/canvg.js"></script>
<script type="text/javascript" src="js/FileSaver.js"></script>
<script type="text/javascript" src="js/Blob.js"></script>
<script type="text/javascript" src="js/canvas-toBlob.js"></script>
<script type="text/javascript" src="js/misc.js"></script>
<script type="text/javascript" src="js/bootstrap.js"></script>

<body>
  <div class="container">
    &nbsp;
    <div class="row">
      <img src="img/GHOST.png" alt="GHOST" style="width:203px;height:50px;">
    </div>

    <div class="row">
      <h3>Global Hepatitis Outbreak & Surveillance Technology</h3>
    </div>
    &nbsp;
    <div class="row">
      <div class="btn-toolbar" role="toolbar" aria-label="...">
        <div class="btn-group" role="group" aria-label="...">
          <button id="threshold-activate-menu" type="submit" class="btn btn-primary context-menu-threshold">Threshold <span class="caret"></span></button>
          <button id='color-activate-menu' type='button' class='btn btn-primary context-menu-colors' type='submit'>Symbols <span class="caret"></span></button>
        </div>
                
        <div class="btn-group" role="group" aria-label="...">
          <button type="button" class="btn btn-info" onclick="export_image()"><span class="glyphicon glyphicon-floppy-save"></span> Export Image</button>
        </div>

        <div class="btn-group" role="group" aria-label="...">
          <button type="button" class="btn btn-danger" onclick="reset_display()"><span class="glyphicon glyphicon-refresh"></span> Reset</button>
        </div>
      </div>
    </div>
    &nbsp;
    <div class="row">
      <input type='number' id='thresholdNumber' min='0.0' max='0.04' value='0.037' step='0.001'></input>
    </div>

    <div class="row">
      <svg id='transmission-network'></svg>
    </div>
  </div>

  <dialog id='#svg2canvas' style='visibility: hidden'>
    <canvas id='svg-export'></canvas>
  </dialog>

  <script>
    graph = dvh.ghost.TransmissionNetworkModel({"links": [{"dist": 0.0, "genotype": "2a", "shared": 1, "source": 40, "src_haps": 10, "target": 80, "tgt_haps": 8}, {"dist": 0.019043927201396697, "genotype": "2a", "shared": 1, "source": 60, "src_haps": 10, "target": 43, "tgt_haps": 8}, {"dist": 0.03424910275697945, "genotype": "2a", "shared": 1, "source": 60, "src_haps": 10, "target": 9, "tgt_haps": 8}, {"dist": 0.022582304328381056, "genotype": "2a", "shared": 1, "source": 28, "src_haps": 10, "target": 65, "tgt_haps": 8}, {"dist": 0.035476203350126356, "genotype": "2a", "shared": 1, "source": 30, "src_haps": 10, "target": 42, "tgt_haps": 8}, {"dist": 0.023301269452742076, "genotype": "2a", "shared": 1, "source": 32, "src_haps": 10, "target": 62, "tgt_haps": 8}, {"dist": 0.030731374037702392, "genotype": "2a", "shared": 1, "source": 32, "src_haps": 10, "target": 97, "tgt_haps": 8}, {"dist": 0.0054625677839551644, "genotype": "2a", "shared": 1, "source": 35, "src_haps": 10, "target": 44, "tgt_haps": 8}, {"dist": 0.0, "genotype": "2a", "shared": 1, "source": 35, "src_haps": 10, "target": 39, "tgt_haps": 8}, {"dist": 0.03469946381683143, "genotype": "2a", "shared": 1, "source": 35, "src_haps": 10, "target": 75, "tgt_haps": 8}, {"dist": 0.036951027296083766, "genotype": "2a", "shared": 1, "source": 36, "src_haps": 10, "target": 43, "tgt_haps": 8}, {"dist": 0.01959747005837386, "genotype": "2a", "shared": 1, "source": 36, "src_haps": 10, "target": 87, "tgt_haps": 8}, {"dist": 0.02092683231890365, "genotype": "2a", "shared": 1, "source": 36, "src_haps": 10, "target": 20, "tgt_haps": 8}, {"dist": 0.008930689539555113, "genotype": "2a", "shared": 1, "source": 36, "src_haps": 10, "target": 69, "tgt_haps": 8}, {"dist": 0.01579260512534685, "genotype": "2a", "shared": 1, "source": 36, "src_haps": 10, "target": 84, "tgt_haps": 8}, {"dist": 0.01584548230538031, "genotype": "2a", "shared": 1, "source": 38, "src_haps": 10, "target": 71, "tgt_haps": 8}, {"dist": 0.020360842977194135, "genotype": "2a", "shared": 1, "source": 43, "src_haps": 10, "target": 40, "tgt_haps": 8}, {"dist": 0.011294951746597082, "genotype": "2a", "shared": 1, "source": 43, "src_haps": 10, "target": 33, "tgt_haps": 8}, {"dist": 0.0, "genotype": "2a", "shared": 1, "source": 43, "src_haps": 10, "target": 5, "tgt_haps": 8}, {"dist": 0.013146798269772862, "genotype": "2a", "shared": 1, "source": 43, "src_haps": 10, "target": 35, "tgt_haps": 8}, {"dist": 0.022752567556559026, "genotype": "2a", "shared": 1, "source": 45, "src_haps": 10, "target": 43, "tgt_haps": 8}, {"dist": 0.02289325470151015, "genotype": "2a", "shared": 1, "source": 45, "src_haps": 10, "target": 0, "tgt_haps": 8}, {"dist": 0.0028825268048534992, "genotype": "2a", "shared": 1, "source": 45, "src_haps": 10, "target": 100, "tgt_haps": 8}, {"dist": 0.004575537800810915, "genotype": "2a", "shared": 1, "source": 45, "src_haps": 10, "target": 1, "tgt_haps": 8}, {"dist": 0.01261016957360992, "genotype": "2a", "shared": 1, "source": 45, "src_haps": 10, "target": 47, "tgt_haps": 8}, {"dist": 0.01234481485089335, "genotype": "2a", "shared": 1, "source": 45, "src_haps": 10, "target": 59, "tgt_haps": 8}, {"dist": 0.02538132794085456, "genotype": "2a", "shared": 1, "source": 45, "src_haps": 10, "target": 81, "tgt_haps": 8}, {"dist": 0.0036057685849637477, "genotype": "2a", "shared": 1, "source": 45, "src_haps": 10, "target": 53, "tgt_haps": 8}, {"dist": 0.02032220309448035, "genotype": "2a", "shared": 1, "source": 45, "src_haps": 10, "target": 23, "tgt_haps": 8}, {"dist": 0.005193862147538129, "genotype": "2a", "shared": 1, "source": 45, "src_haps": 10, "target": 83, "tgt_haps": 8}, {"dist": 0.009399396857115076, "genotype": "2a", "shared": 1, "source": 45, "src_haps": 10, "target": 86, "tgt_haps": 8}, {"dist": 0.01806347247016284, "genotype": "2a", "shared": 1, "source": 45, "src_haps": 10, "target": 21, "tgt_haps": 8}, {"dist": 0.018827997659031023, "genotype": "2a", "shared": 1, "source": 47, "src_haps": 10, "target": 66, "tgt_haps": 8}, {"dist": 0.021450639204650377, "genotype": "2a", "shared": 1, "source": 48, "src_haps": 10, "target": 18, "tgt_haps": 8}, {"dist": 0.014062966397551446, "genotype": "2a", "shared": 1, "source": 51, "src_haps": 10, "target": 31, "tgt_haps": 8}, {"dist": 0.0, "genotype": "2a", "shared": 1, "source": 51, "src_haps": 10, "target": 17, "tgt_haps": 8}, {"dist": 0.018755776549704478, "genotype": "2a", "shared": 1, "source": 51, "src_haps": 10, "target": 8, "tgt_haps": 8}, {"dist": 0.024068046175641605, "genotype": "2a", "shared": 1, "source": 51, "src_haps": 10, "target": 55, "tgt_haps": 8}, {"dist": 0.0029189837155513426, "genotype": "2a", "shared": 1, "source": 51, "src_haps": 10, "target": 25, "tgt_haps": 8}, {"dist": 0.031015711832324273, "genotype": "2a", "shared": 1, "source": 51, "src_haps": 10, "target": 61, "tgt_haps": 8}, {"dist": 0.015419827816413647, "genotype": "2a", "shared": 1, "source": 51, "src_haps": 10, "target": 56, "tgt_haps": 8}, {"dist": 0.028006715474571994, "genotype": "2a", "shared": 1, "source": 51, "src_haps": 10, "target": 64, "tgt_haps": 8}, {"dist": 0.03337742331841924, "genotype": "2a", "shared": 1, "source": 51, "src_haps": 10, "target": 92, "tgt_haps": 8}, {"dist": 0.0186811131487036, "genotype": "2a", "shared": 1, "source": 51, "src_haps": 10, "target": 38, "tgt_haps": 8}, {"dist": 0.017479505800020004, "genotype": "2a", "shared": 1, "source": 51, "src_haps": 10, "target": 94, "tgt_haps": 8}, {"dist": 0.0026266190247925063, "genotype": "2a", "shared": 1, "source": 53, "src_haps": 10, "target": 82, "tgt_haps": 8}, {"dist": 0.0, "genotype": "2a", "shared": 1, "source": 58, "src_haps": 10, "target": 98, "tgt_haps": 8}, {"dist": 0.020893245592409765, "genotype": "2a", "shared": 1, "source": 58, "src_haps": 10, "target": 72, "tgt_haps": 8}, {"dist": 0.0056242928223896186, "genotype": "2a", "shared": 1, "source": 58, "src_haps": 10, "target": 74, "tgt_haps": 8}, {"dist": 0.020143534206569558, "genotype": "2a", "shared": 1, "source": 58, "src_haps": 10, "target": 77, "tgt_haps": 8}, {"dist": 0.015027501851167328, "genotype": "2a", "shared": 1, "source": 58, "src_haps": 10, "target": 15, "tgt_haps": 8}, {"dist": 0.02032155350055886, "genotype": "2a", "shared": 1, "source": 58, "src_haps": 10, "target": 45, "tgt_haps": 8}, {"dist": 0.018539579311858637, "genotype": "2a", "shared": 1, "source": 58, "src_haps": 10, "target": 36, "tgt_haps": 8}, {"dist": 0.026695420439611452, "genotype": "2a", "shared": 1, "source": 58, "src_haps": 10, "target": 93, "tgt_haps": 8}, {"dist": 0.0069966120400213145, "genotype": "2a", "shared": 1, "source": 58, "src_haps": 10, "target": 70, "tgt_haps": 8}, {"dist": 0.01381066708282936, "genotype": "2a", "shared": 1, "source": 61, "src_haps": 10, "target": 28, "tgt_haps": 8}, {"dist": 0.019769899579273532, "genotype": "2a", "shared": 1, "source": 61, "src_haps": 10, "target": 29, "tgt_haps": 8}, {"dist": 0.03681846058058536, "genotype": "2a", "shared": 1, "source": 61, "src_haps": 10, "target": 49, "tgt_haps": 8}, {"dist": 0.016835560313679776, "genotype": "2a", "shared": 1, "source": 61, "src_haps": 10, "target": 26, "tgt_haps": 8}, {"dist": 0.03421113652849065, "genotype": "2a", "shared": 1, "source": 64, "src_haps": 10, "target": 54, "tgt_haps": 8}, {"dist": 0.030174847824128034, "genotype": "2a", "shared": 1, "source": 66, "src_haps": 10, "target": 52, "tgt_haps": 8}, {"dist": 0.0023908394811835787, "genotype": "2a", "shared": 1, "source": 68, "src_haps": 10, "target": 89, "tgt_haps": 8}, {"dist": 0.008777578140409728, "genotype": "2a", "shared": 1, "source": 72, "src_haps": 10, "target": 16, "tgt_haps": 8}, {"dist": 0.00537768362096256, "genotype": "2a", "shared": 1, "source": 72, "src_haps": 10, "target": 46, "tgt_haps": 8}, {"dist": 0.009390853327596118, "genotype": "2a", "shared": 1, "source": 72, "src_haps": 10, "target": 60, "tgt_haps": 8}, {"dist": 0.030612045956858326, "genotype": "2a", "shared": 1, "source": 72, "src_haps": 10, "target": 76, "tgt_haps": 8}, {"dist": 0.012311283805318231, "genotype": "2a", "shared": 1, "source": 78, "src_haps": 10, "target": 58, "tgt_haps": 8}, {"dist": 0.01791409643317733, "genotype": "2a", "shared": 1, "source": 88, "src_haps": 10, "target": 14, "tgt_haps": 8}, {"dist": 0.009880748701005951, "genotype": "2a", "shared": 1, "source": 89, "src_haps": 10, "target": 2, "tgt_haps": 8}, {"dist": 0.0, "genotype": "2a", "shared": 1, "source": 89, "src_haps": 10, "target": 24, "tgt_haps": 8}, {"dist": 0.013459689930425437, "genotype": "2a", "shared": 1, "source": 90, "src_haps": 10, "target": 96, "tgt_haps": 8}, {"dist": 0.027525124534811294, "genotype": "2a", "shared": 1, "source": 92, "src_haps": 10, "target": 19, "tgt_haps": 8}, {"dist": 0.010689980479283118, "genotype": "2a", "shared": 1, "source": 92, "src_haps": 10, "target": 30, "tgt_haps": 8}, {"dist": 0.022428573607022953, "genotype": "2a", "shared": 1, "source": 92, "src_haps": 10, "target": 3, "tgt_haps": 8}, {"dist": 0.027204262275594023, "genotype": "2a", "shared": 1, "source": 92, "src_haps": 10, "target": 95, "tgt_haps": 8}, {"dist": 0.026653317160191096, "genotype": "2a", "shared": 1, "source": 95, "src_haps": 10, "target": 50, "tgt_haps": 8}, {"dist": 0.002343755800330198, "genotype": "2a", "shared": 1, "source": 96, "src_haps": 10, "target": 88, "tgt_haps": 8}, {"dist": 0.0021146479087516268, "genotype": "2a", "shared": 1, "source": 98, "src_haps": 10, "target": 99, "tgt_haps": 8}, {"dist": 0.03612916235517836, "genotype": "2a", "shared": 1, "source": 98, "src_haps": 10, "target": 73, "tgt_haps": 8}, {"dist": 0.0076322379295357175, "genotype": "2a", "shared": 1, "source": 98, "src_haps": 10, "target": 51, "tgt_haps": 8}, {"dist": 0.016183195674412443, "genotype": "2a", "shared": 1, "source": 98, "src_haps": 10, "target": 79, "tgt_haps": 8}, {"dist": 0.013785107744813634, "genotype": "2a", "shared": 1, "source": 98, "src_haps": 10, "target": 37, "tgt_haps": 8}, {"dist": 0.015745834794663672, "genotype": "2a", "shared": 1, "source": 98, "src_haps": 10, "target": 68, "tgt_haps": 8}, {"dist": 0.014538816401660803, "genotype": "2a", "shared": 1, "source": 3, "src_haps": 10, "target": 13, "tgt_haps": 8}, {"dist": 0.0017844049736022074, "genotype": "2a", "shared": 1, "source": 3, "src_haps": 10, "target": 11, "tgt_haps": 8}, {"dist": 0.002560696918197368, "genotype": "2a", "shared": 1, "source": 3, "src_haps": 10, "target": 14, "tgt_haps": 8}, {"dist": 0.03386008021240689, "genotype": "2a", "shared": 1, "source": 3, "src_haps": 10, "target": 34, "tgt_haps": 8}, {"dist": 0.0034764227590347845, "genotype": "2a", "shared": 1, "source": 5, "src_haps": 10, "target": 27, "tgt_haps": 8}, {"dist": 0.015485596858938699, "genotype": "2a", "shared": 1, "source": 5, "src_haps": 10, "target": 91, "tgt_haps": 8}, {"dist": 0.003430876713025456, "genotype": "2a", "shared": 1, "source": 5, "src_haps": 10, "target": 32, "tgt_haps": 8}, {"dist": 0.01847403124602955, "genotype": "2a", "shared": 1, "source": 5, "src_haps": 10, "target": 41, "tgt_haps": 8}, {"dist": 0.03289866601799232, "genotype": "2a", "shared": 1, "source": 7, "src_haps": 10, "target": 10, "tgt_haps": 8}, {"dist": 0.006912929207616591, "genotype": "2a", "shared": 1, "source": 8, "src_haps": 10, "target": 7, "tgt_haps": 8}, {"dist": 0.028971391439176434, "genotype": "2a", "shared": 1, "source": 8, "src_haps": 10, "target": 62, "tgt_haps": 8}, {"dist": 0.021127429795538617, "genotype": "2a", "shared": 1, "source": 10, "src_haps": 10, "target": 48, "tgt_haps": 8}, {"dist": 0.0036946483747368054, "genotype": "2a", "shared": 1, "source": 12, "src_haps": 10, "target": 63, "tgt_haps": 8}, {"dist": 0.035894560921844926, "genotype": "2a", "shared": 1, "source": 17, "src_haps": 10, "target": 4, "tgt_haps": 8}, {"dist": 0.009399191317081442, "genotype": "2a", "shared": 1, "source": 17, "src_haps": 10, "target": 6, "tgt_haps": 8}, {"dist": 0.011620614579391637, "genotype": "2a", "shared": 1, "source": 17, "src_haps": 10, "target": 12, "tgt_haps": 8}, {"dist": 0.032922244036589894, "genotype": "2a", "shared": 1, "source": 17, "src_haps": 10, "target": 57, "tgt_haps": 8}, {"dist": 0.0247351475770592, "genotype": "2a", "shared": 1, "source": 17, "src_haps": 10, "target": 22, "tgt_haps": 8}, {"dist": 0.018582758196563638, "genotype": "2a", "shared": 1, "source": 17, "src_haps": 10, "target": 90, "tgt_haps": 8}, {"dist": 0.030835574345996587, "genotype": "2a", "shared": 1, "source": 17, "src_haps": 10, "target": 67, "tgt_haps": 8}, {"dist": 0.014663943315256852, "genotype": "2a", "shared": 1, "source": 21, "src_haps": 10, "target": 85, "tgt_haps": 8}], "samples": [{"genotypes": {"2a": {"haplotypes": 41, "max_freq": Infinity, "n_diversity": 0.20690666666666666, "total_freq": 100}}, "group": 60, "id": 0, "name": "sample0"}, {"genotypes": {"2a": {"haplotypes": 45, "max_freq": Infinity, "n_diversity": 0.3488059849385652, "total_freq": 116}}, "group": 60, "id": 1, "name": "sample1"}, {"genotypes": {"2a": {"haplotypes": 48, "max_freq": Infinity, "n_diversity": 0.24543765218505703, "total_freq": 102}}, "group": 60, "id": 2, "name": "sample10"}, {"genotypes": {"2a": {"haplotypes": 42, "max_freq": Infinity, "n_diversity": 0.20222197072581863, "total_freq": 94}}, "group": 60, "id": 3, "name": "sample100"}, {"genotypes": {"2a": {"haplotypes": 41, "max_freq": Infinity, "n_diversity": 0.2772880658436214, "total_freq": 90}}, "group": 60, "id": 4, "name": "sample101"}, {"genotypes": {"2a": {"haplotypes": 42, "max_freq": Infinity, "n_diversity": 0.23211805555555556, "total_freq": 96}}, "group": 60, "id": 5, "name": "sample102"}, {"genotypes": {"2a": {"haplotypes": 42, "max_freq": Infinity, "n_diversity": 0.31666319589060116, "total_freq": 98}}, "group": 60, "id": 6, "name": "sample103"}, {"genotypes": {"2a": {"haplotypes": 54, "max_freq": Infinity, "n_diversity": 0.4125739644970414, "total_freq": 104}}, "group": 60, "id": 7, "name": "sample104"}, {"genotypes": {"2a": {"haplotypes": 43, "max_freq": Infinity, "n_diversity": 0.2878835207552409, "total_freq": 98}}, "group": 60, "id": 8, "name": "sample105"}, {"genotypes": {"2a": {"haplotypes": 52, "max_freq": Infinity, "n_diversity": 0.459561528420553, "total_freq": 106}}, "group": 60, "id": 9, "name": "sample106"}, {"genotypes": {"2a": {"haplotypes": 46, "max_freq": Infinity, "n_diversity": 0.46742854683195595, "total_freq": 88}}, "group": 60, "id": 10, "name": "sample107"}, {"genotypes": {"2a": {"haplotypes": 36, "max_freq": Infinity, "n_diversity": 0.4673658352229781, "total_freq": 84}}, "group": 60, "id": 11, "name": "sample108"}, {"genotypes": {"2a": {"haplotypes": 45, "max_freq": Infinity, "n_diversity": 0.18601333333333334, "total_freq": 100}}, "group": 60, "id": 12, "name": "sample109"}, {"genotypes": {"2a": {"haplotypes": 44, "max_freq": Infinity, "n_diversity": 0.27516598762637695, "total_freq": 94}}, "group": 60, "id": 13, "name": "sample11"}, {"genotypes": {"2a": {"haplotypes": 41, "max_freq": Infinity, "n_diversity": 0.26749967961040627, "total_freq": 102}}, "group": 60, "id": 14, "name": "sample111"}, {"genotypes": {"2a": {"haplotypes": 50, "max_freq": Infinity, "n_diversity": 0.2314494425221069, "total_freq": 102}}, "group": 60, "id": 15, "name": "sample112"}, {"genotypes": {"2a": {"haplotypes": 43, "max_freq": Infinity, "n_diversity": 0.3617096725516825, "total_freq": 94}}, "group": 60, "id": 16, "name": "sample113"}, {"genotypes": {"2a": {"haplotypes": 44, "max_freq": Infinity, "n_diversity": 0.29059842687074827, "total_freq": 112}}, "group": 60, "id": 17, "name": "sample114"}, {"genotypes": {"2a": {"haplotypes": 43, "max_freq": Infinity, "n_diversity": 0.3656542355504293, "total_freq": 102}}, "group": 60, "id": 18, "name": "sample115"}, {"genotypes": {"2a": {"haplotypes": 44, "max_freq": Infinity, "n_diversity": 0.3843225045120089, "total_freq": 98}}, "group": 60, "id": 19, "name": "sample116"}, {"genotypes": {"2a": {"haplotypes": 34, "max_freq": Infinity, "n_diversity": 0.23400245949074075, "total_freq": 96}}, "group": 60, "id": 20, "name": "sample117"}, {"genotypes": {"2a": {"haplotypes": 50, "max_freq": Infinity, "n_diversity": 0.2652398735995404, "total_freq": 118}}, "group": 60, "id": 21, "name": "sample118"}, {"genotypes": {"2a": {"haplotypes": 37, "max_freq": Infinity, "n_diversity": 0.3191715708465369, "total_freq": 94}}, "group": 60, "id": 22, "name": "sample119"}, {"genotypes": {"2a": {"haplotypes": 45, "max_freq": Infinity, "n_diversity": 0.2714011863425926, "total_freq": 96}}, "group": 60, "id": 23, "name": "sample12"}, {"genotypes": {"2a": {"haplotypes": 40, "max_freq": Infinity, "n_diversity": 0.42472113444879556, "total_freq": 106}}, "group": 60, "id": 24, "name": "sample13"}, {"genotypes": {"2a": {"haplotypes": 37, "max_freq": Infinity, "n_diversity": 0.28018236380424744, "total_freq": 76}}, "group": 60, "id": 25, "name": "sample14"}, {"genotypes": {"2a": {"haplotypes": 38, "max_freq": Infinity, "n_diversity": 0.22908722331799256, "total_freq": 78}}, "group": 60, "id": 26, "name": "sample15"}, {"genotypes": {"2a": {"haplotypes": 37, "max_freq": Infinity, "n_diversity": 0.2737037037037037, "total_freq": 90}}, "group": 60, "id": 27, "name": "sample16"}, {"genotypes": {"2a": {"haplotypes": 49, "max_freq": Infinity, "n_diversity": 0.31675, "total_freq": 120}}, "group": 60, "id": 28, "name": "sample17"}, {"genotypes": {"2a": {"haplotypes": 51, "max_freq": Infinity, "n_diversity": 0.24113498622589533, "total_freq": 110}}, "group": 60, "id": 29, "name": "sample18"}, {"genotypes": {"2a": {"haplotypes": 35, "max_freq": Infinity, "n_diversity": 0.16224489795918368, "total_freq": 84}}, "group": 60, "id": 30, "name": "sample19"}, {"genotypes": {"2a": {"haplotypes": 39, "max_freq": Infinity, "n_diversity": 0.3625966666666667, "total_freq": 100}}, "group": 60, "id": 31, "name": "sample2"}, {"genotypes": {"2a": {"haplotypes": 44, "max_freq": Infinity, "n_diversity": 0.3271049063116371, "total_freq": 104}}, "group": 60, "id": 32, "name": "sample20"}, {"genotypes": {"2a": {"haplotypes": 45, "max_freq": Infinity, "n_diversity": 0.22603305785123967, "total_freq": 88}}, "group": 60, "id": 33, "name": "sample21"}, {"genotypes": {"2a": {"haplotypes": 50, "max_freq": Infinity, "n_diversity": 0.28268461362597164, "total_freq": 108}}, "group": 60, "id": 34, "name": "sample22"}, {"genotypes": {"2a": {"haplotypes": 42, "max_freq": Infinity, "n_diversity": 0.23489363065487634, "total_freq": 102}}, "group": 60, "id": 35, "name": "sample23"}, {"genotypes": {"2a": {"haplotypes": 36, "max_freq": Infinity, "n_diversity": 0.36232277199074076, "total_freq": 96}}, "group": 60, "id": 36, "name": "sample24"}, {"genotypes": {"2a": {"haplotypes": 37, "max_freq": Infinity, "n_diversity": 0.21053440984236832, "total_freq": 102}}, "group": 60, "id": 37, "name": "sample25"}, {"genotypes": {"2a": {"haplotypes": 39, "max_freq": Infinity, "n_diversity": 0.10399525823401255, "total_freq": 102}}, "group": 60, "id": 38, "name": "sample27"}, {"genotypes": {"2a": {"haplotypes": 38, "max_freq": Infinity, "n_diversity": 0.15946506714953976, "total_freq": 94}}, "group": 60, "id": 39, "name": "sample28"}, {"genotypes": {"2a": {"haplotypes": 50, "max_freq": Infinity, "n_diversity": 0.28483746556473827, "total_freq": 110}}, "group": 60, "id": 40, "name": "sample3"}, {"genotypes": {"2a": {"haplotypes": 42, "max_freq": Infinity, "n_diversity": 0.44747623358985966, "total_freq": 94}}, "group": 60, "id": 41, "name": "sample30"}, {"genotypes": {"2a": {"haplotypes": 32, "max_freq": Infinity, "n_diversity": 0.2954975662520281, "total_freq": 86}}, "group": 60, "id": 42, "name": "sample31"}, {"genotypes": {"2a": {"haplotypes": 35, "max_freq": Infinity, "n_diversity": 0.3502284183994959, "total_freq": 92}}, "group": 60, "id": 43, "name": "sample32"}, {"genotypes": {"2a": {"haplotypes": 42, "max_freq": Infinity, "n_diversity": 0.38257884412252907, "total_freq": 94}}, "group": 60, "id": 44, "name": "sample33"}, {"genotypes": {"2a": {"haplotypes": 45, "max_freq": Infinity, "n_diversity": 0.1897283096245034, "total_freq": 102}}, "group": 60, "id": 45, "name": "sample35"}, {"genotypes": {"2a": {"haplotypes": 58, "max_freq": Infinity, "n_diversity": 0.3303313609467456, "total_freq": 130}}, "group": 60, "id": 46, "name": "sample36"}, {"genotypes": {"2a": {"haplotypes": 32, "max_freq": Infinity, "n_diversity": 0.19958908612754767, "total_freq": 78}}, "group": 60, "id": 47, "name": "sample38"}, {"genotypes": {"2a": {"haplotypes": 42, "max_freq": Infinity, "n_diversity": 0.27757642998027615, "total_freq": 104}}, "group": 60, "id": 48, "name": "sample39"}, {"genotypes": {"2a": {"haplotypes": 48, "max_freq": Infinity, "n_diversity": 0.23612962962962963, "total_freq": 120}}, "group": 60, "id": 49, "name": "sample4"}, {"genotypes": {"2a": {"haplotypes": 37, "max_freq": Infinity, "n_diversity": 0.3706028157842554, "total_freq": 82}}, "group": 60, "id": 50, "name": "sample40"}, {"genotypes": {"2a": {"haplotypes": 42, "max_freq": Infinity, "n_diversity": 0.25932548664554095, "total_freq": 94}}, "group": 60, "id": 51, "name": "sample41"}, {"genotypes": {"2a": {"haplotypes": 37, "max_freq": Infinity, "n_diversity": 0.3387448559670782, "total_freq": 90}}, "group": 60, "id": 52, "name": "sample42"}, {"genotypes": {"2a": {"haplotypes": 41, "max_freq": Infinity, "n_diversity": 0.3293698825204699, "total_freq": 106}}, "group": 60, "id": 53, "name": "sample43"}, {"genotypes": {"2a": {"haplotypes": 50, "max_freq": Infinity, "n_diversity": 0.33152104591836734, "total_freq": 112}}, "group": 60, "id": 54, "name": "sample44"}, {"genotypes": {"2a": {"haplotypes": 48, "max_freq": Infinity, "n_diversity": 0.1978085351787774, "total_freq": 102}}, "group": 60, "id": 55, "name": "sample45"}, {"genotypes": {"2a": {"haplotypes": 47, "max_freq": Infinity, "n_diversity": 0.26416377314814815, "total_freq": 96}}, "group": 60, "id": 56, "name": "sample46"}, {"genotypes": {"2a": {"haplotypes": 44, "max_freq": Infinity, "n_diversity": 0.33402777777777776, "total_freq": 96}}, "group": 60, "id": 57, "name": "sample47"}, {"genotypes": {"2a": {"haplotypes": 40, "max_freq": Infinity, "n_diversity": 0.24479889807162533, "total_freq": 110}}, "group": 60, "id": 58, "name": "sample48"}, {"genotypes": {"2a": {"haplotypes": 33, "max_freq": Infinity, "n_diversity": 0.2887482782369146, "total_freq": 88}}, "group": 60, "id": 59, "name": "sample49"}, {"genotypes": {"2a": {"haplotypes": 43, "max_freq": Infinity, "n_diversity": 0.24222195967233776, "total_freq": 92}}, "group": 60, "id": 60, "name": "sample5"}, {"genotypes": {"2a": {"haplotypes": 45, "max_freq": Infinity, "n_diversity": 0.32286574074074076, "total_freq": 120}}, "group": 60, "id": 61, "name": "sample50"}, {"genotypes": {"2a": {"haplotypes": 50, "max_freq": Infinity, "n_diversity": 0.25119505318467256, "total_freq": 102}}, "group": 60, "id": 62, "name": "sample52"}, {"genotypes": {"2a": {"haplotypes": 50, "max_freq": Infinity, "n_diversity": 0.33586, "total_freq": 100}}, "group": 60, "id": 63, "name": "sample53"}, {"genotypes": {"2a": {"haplotypes": 43, "max_freq": Infinity, "n_diversity": 0.22036625514403294, "total_freq": 90}}, "group": 60, "id": 64, "name": "sample55"}, {"genotypes": {"2a": {"haplotypes": 57, "max_freq": Infinity, "n_diversity": 0.31225179036458334, "total_freq": 128}}, "group": 60, "id": 65, "name": "sample56"}, {"genotypes": {"2a": {"haplotypes": 50, "max_freq": Infinity, "n_diversity": 0.3544577818816046, "total_freq": 114}}, "group": 60, "id": 66, "name": "sample58"}, {"genotypes": {"2a": {"haplotypes": 35, "max_freq": Infinity, "n_diversity": 0.17613550626226046, "total_freq": 94}}, "group": 60, "id": 67, "name": "sample59"}, {"genotypes": {"2a": {"haplotypes": 46, "max_freq": Infinity, "n_diversity": 0.21927463795975907, "total_freq": 102}}, "group": 60, "id": 68, "name": "sample61"}, {"genotypes": {"2a": {"haplotypes": 48, "max_freq": Infinity, "n_diversity": 0.283074279265415, "total_freq": 114}}, "group": 60, "id": 69, "name": "sample62"}, {"genotypes": {"2a": {"haplotypes": 35, "max_freq": Infinity, "n_diversity": 0.29604424931129475, "total_freq": 88}}, "group": 60, "id": 70, "name": "sample63"}, {"genotypes": {"2a": {"haplotypes": 34, "max_freq": Infinity, "n_diversity": 0.33600045269352646, "total_freq": 94}}, "group": 60, "id": 71, "name": "sample64"}, {"genotypes": {"2a": {"haplotypes": 45, "max_freq": Infinity, "n_diversity": 0.24195816186556926, "total_freq": 108}}, "group": 60, "id": 72, "name": "sample65"}, {"genotypes": {"2a": {"haplotypes": 43, "max_freq": Infinity, "n_diversity": 0.26531373274161735, "total_freq": 104}}, "group": 60, "id": 73, "name": "sample66"}, {"genotypes": {"2a": {"haplotypes": 46, "max_freq": Infinity, "n_diversity": 0.321956176878842, "total_freq": 82}}, "group": 60, "id": 74, "name": "sample67"}, {"genotypes": {"2a": {"haplotypes": 44, "max_freq": Infinity, "n_diversity": 0.4365267489711934, "total_freq": 90}}, "group": 60, "id": 75, "name": "sample7"}, {"genotypes": {"2a": {"haplotypes": 36, "max_freq": Infinity, "n_diversity": 0.30495037807183367, "total_freq": 92}}, "group": 60, "id": 76, "name": "sample70"}, {"genotypes": {"2a": {"haplotypes": 37, "max_freq": Infinity, "n_diversity": 0.3007739830626128, "total_freq": 98}}, "group": 60, "id": 77, "name": "sample71"}, {"genotypes": {"2a": {"haplotypes": 44, "max_freq": Infinity, "n_diversity": 0.17268, "total_freq": 100}}, "group": 60, "id": 78, "name": "sample73"}, {"genotypes": {"2a": {"haplotypes": 47, "max_freq": Infinity, "n_diversity": 0.27985333333333334, "total_freq": 100}}, "group": 60, "id": 79, "name": "sample74"}, {"genotypes": {"2a": {"haplotypes": 38, "max_freq": Infinity, "n_diversity": 0.20678, "total_freq": 100}}, "group": 60, "id": 80, "name": "sample75"}, {"genotypes": {"2a": {"haplotypes": 38, "max_freq": Infinity, "n_diversity": 0.20899190771349863, "total_freq": 88}}, "group": 60, "id": 81, "name": "sample76"}, {"genotypes": {"2a": {"haplotypes": 41, "max_freq": Infinity, "n_diversity": 0.29483208733831734, "total_freq": 106}}, "group": 60, "id": 82, "name": "sample77"}, {"genotypes": {"2a": {"haplotypes": 44, "max_freq": Infinity, "n_diversity": 0.31967230902777777, "total_freq": 96}}, "group": 60, "id": 83, "name": "sample78"}, {"genotypes": {"2a": {"haplotypes": 46, "max_freq": Infinity, "n_diversity": 0.18699207988980715, "total_freq": 88}}, "group": 60, "id": 84, "name": "sample79"}, {"genotypes": {"2a": {"haplotypes": 36, "max_freq": Infinity, "n_diversity": 0.1171772754312909, "total_freq": 82}}, "group": 60, "id": 85, "name": "sample80"}, {"genotypes": {"2a": {"haplotypes": 42, "max_freq": Infinity, "n_diversity": 0.25011333333333335, "total_freq": 100}}, "group": 60, "id": 86, "name": "sample81"}, {"genotypes": {"2a": {"haplotypes": 40, "max_freq": Infinity, "n_diversity": 0.1596607349537037, "total_freq": 96}}, "group": 60, "id": 87, "name": "sample82"}, {"genotypes": {"2a": {"haplotypes": 50, "max_freq": Infinity, "n_diversity": 0.356168044077135, "total_freq": 110}}, "group": 60, "id": 88, "name": "sample83"}, {"genotypes": {"2a": {"haplotypes": 44, "max_freq": Infinity, "n_diversity": 0.3057996668054977, "total_freq": 98}}, "group": 60, "id": 89, "name": "sample85"}, {"genotypes": {"2a": {"haplotypes": 46, "max_freq": Infinity, "n_diversity": 0.25285208047553726, "total_freq": 108}}, "group": 60, "id": 90, "name": "sample89"}, {"genotypes": {"2a": {"haplotypes": 52, "max_freq": Infinity, "n_diversity": 0.27509553747534515, "total_freq": 104}}, "group": 60, "id": 91, "name": "sample9"}, {"genotypes": {"2a": {"haplotypes": 39, "max_freq": Infinity, "n_diversity": 0.41504451486343746, "total_freq": 94}}, "group": 60, "id": 92, "name": "sample90"}, {"genotypes": {"2a": {"haplotypes": 47, "max_freq": Infinity, "n_diversity": 0.2258929630948143, "total_freq": 106}}, "group": 60, "id": 93, "name": "sample91"}, {"genotypes": {"2a": {"haplotypes": 24, "max_freq": Infinity, "n_diversity": 0.3322845804988662, "total_freq": 84}}, "group": 60, "id": 94, "name": "sample92"}, {"genotypes": {"2a": {"haplotypes": 45, "max_freq": Infinity, "n_diversity": 0.23302776788892846, "total_freq": 106}}, "group": 60, "id": 95, "name": "sample93"}, {"genotypes": {"2a": {"haplotypes": 37, "max_freq": Infinity, "n_diversity": 0.22633744855967078, "total_freq": 90}}, "group": 60, "id": 96, "name": "sample94"}, {"genotypes": {"2a": {"haplotypes": 38, "max_freq": Infinity, "n_diversity": 0.265693167477916, "total_freq": 86}}, "group": 60, "id": 97, "name": "sample95"}, {"genotypes": {"2a": {"haplotypes": 39, "max_freq": Infinity, "n_diversity": 0.3756855867346939, "total_freq": 112}}, "group": 60, "id": 98, "name": "sample96"}, {"genotypes": {"2a": {"haplotypes": 44, "max_freq": Infinity, "n_diversity": 0.4009077963688145, "total_freq": 106}}, "group": 60, "id": 99, "name": "sample97"}, {"genotypes": {"2a": {"haplotypes": 33, "max_freq": Infinity, "n_diversity": 0.3726077428780131, "total_freq": 74}}, "group": 60, "id": 100, "name": "sample99"}], "version": 1});
    layout = dvh.ghost.TransmissionNetorkPresenter(graph);

    width = 1200, height = 1000;
    svg_el = d3.select('#transmission-network');

    svg_el
      .attr("position", "absolute")
      .attr("width", width)
      .attr("height", height);

    prev_tick = Date.now();
    flayout = d3.layout.force()
      .size([width, height])
      .linkDistance(function(d) { return 350 / (1 + Math.pow(Math.E, -d.dist)); })
      .friction(0.9)
      .charge(-410)
      .gravity(0.2)
      .theta(0.8)
      .alpha(0.1)
      .on("tick", function(e) {
        var center_x = width / 2;
        var center_y = height / 2;

        var tick = Date.now();
        var update_hull = prev_tick + 150 > tick; // do time consuming things occasionally
        prev_tick = tick;

        if(update_hull) {
          graph.update_hull();
        }

        svg_el.selectAll('.node')
          .filter(function(d) { return d.active; })
          .each(function(el, idx) {
            if(el._push_out) {
              rel_x = (el.x - center_x);
              rel_y = (el.y - center_y);

              if(el._in_hull) {
                // so long as we overlap the hull containing the centered nodes
                // push with linear force.
                el.x += 0.05 * rel_x;
                el.y += 0.05 * rel_y;
              } else {
                // ok we are outside the hull the force can decay now
                el.x += 0.12 * rel_x * e.alpha;
                el.y += 0.12 * rel_y * e.alpha;
              }
            }

            // push the nodes away from (0,0) so that they don't
            // go off the left/top of the screen. The 'epsilon' small
            // value is so that we don't get division by zero error
            el.x = Math.min(Math.max(0, el.x), width);
            el.y = Math.min(Math.max(0, el.y), width);
          })
          .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });

        svg_el.selectAll('.link')
          .filter(function(d) {
            return d.active;
           })
          .attr("x1", function(d) { return d.source.x; })
          .attr("y1", function(d) { return d.source.y; })
          .attr("x2", function(d) { return d.target.x; })
          .attr("y2", function(d) { return d.target.y; });

        svg_el.selectAll('.label')
          .filter(function(d) { return d.active; })
          .attr('transform', function(d) { return 'translate(' + d.x + ',' + d.y + ')'; })
      });

    // start sets up some data structures the label layout needs to go first
    flayout
      .nodes(graph.samples)
      .links(graph.links)
      .start();

    function redraw_graph() {
      // Filter the list of links to only the active ones.
      flayout
        .links(
          graph.links.filter(function(el, index, arr) { return el.active; }))
        .nodes(
          graph.samples.filter(function(el, index, arr) { return el.active; }))
        .start();
    }

    function reset_highlight() {
      svg_el.selectAll('.node')
        .data(graph.samples)
        .style('fill-opacity', function(d) { return d._dim?0.2:1.0; });

      svg_el.selectAll('.link')
        .data(graph.links)
        .style('fill-opacity', function(d) { return d.source._dim? 0.2:1.0; });

      flayout.alpha(.1);
    }

    function reset_display() {
      $('#thresholdNumber').val("0.037");
      graph.reset();
      graph.threshold_links(0.037);
    }

    function export_image() {
      var canvas = document.getElementById('svg-export');
      var svg = document.getElementById('transmission-network');
      var bbox = svg.getBBox();

      canvas.width = bbox.width;
      canvas.height = bbox.height;
      canvg(canvas, "<svg transform='translate(" + -bbox.x + "," + -bbox.y + ")'>" + svg.innerHTML + "</svg>");

      canvas.toBlob(function(blob) {
        saveAs(blob, 'transmission-network.png');
      });
    }

    //threshold button context menu
    $(function(){
      $('#threshold-activate-menu').on('click', function(e) {
        e.preventDefault();
        $('.context-menu-threshold').contextMenu();
      });

      $.contextMenu({
        selector: '.context-menu-threshold',
        trigger: 'none',
        items: {
          shared: {
            name: 'Share Sequence',
            callback: function(key, options) {
              graph.threshold_links($('#thresholdNumber').val());
          }},
          strain: {
            name: 'Strain',
            callback: function(key, options) {
              graph.threshold_links($('#thresholdNumber').val());
          }}
        }});
    });

    // color context menu
    $(function() {
      $('#color-activate-menu').on('click', function(e) {
        e.preventDefault();
        $('.context-menu-colors').contextMenu();
      });

      $.contextMenu({
        selector: '.context-menu-colors',
        trigger: 'none',
        items: {
          display_genotype: {
            name: 'By Genotypes',
            callback: function(key, options) {
              graph.set_ordinal('genotype');
          }},
          by_current_group: {
            name: 'By Cluster',
            callback: function(key, options) {
              graph.set_ordinal('_curr_group');
          }},
        by_strain: {
          name: 'By Strain',
          callback: function(key, options) {
            graph.set_ordinal('group', true);
        }}
      }});
    });

    // SVG Context Menu
    $(function() {
      $.contextMenu({
        selector: '#transmission-network',
        trigger: 'right',
        autoHide: true,
        items: {
          select_none: {
            name: 'Select None',
            callback: function(key, options) {
              graph.update_selected(function(d) { return false; });
            }},
          freeze: {
            name: 'Freeze',
            callback: function(key, options) {
              flayout.stop();
            }},
          fold0: {
            name: 'Labels',
            items: {
              show_labels: {
                name: 'Show',
                callback: function(key, options) {
                  graph.labels_visible(true);
                }},
              hide_labels: {
                name: 'Hide',
                callback: function(key, options) {
                  graph.labels_visible(false);
                }},
            }},
          fold1: {
            name: 'On Selected',
            items: {
              fold0: {
                name: 'Set Emphasis',
                items: {
                  highlight: {
                    name: 'Highlight',
                    callback: function(key, options) {
                      graph.samples.forEach(function(el, idx) {
                        if(el.selected) {
                          el._dim = false;
                          el._push_out = false;
                        }
                      });
                      reset_highlight();
                  }}
              }},
          }},
        export_image : {
          name: 'Export Image',
          callback: function(key, options) {
            export_image();
          }
        }}
      });
    });

    // Node context menu
    $(function(){
      $.contextMenu({
          selector: '.context-menu-node',
          trigger: 'right',
          autoHide: false,
          build: function($trigger, e) {
            var trigNode = $trigger[0].__data__;

            return { items: {
                pin: {
                  name: "Pin Node",
                  visible: !trigNode._pinned,
                  callback: function(key, options) {
                    trigNode.fixed = true;
                    trigNode._pinned = true; // fixed gets strange values sometimes
                  }},
                unpin: {
                  name: "Unpin Node",
                  visible: trigNode._pinned,
                  callback: function(key, options) {
                    trigNode.fixed = false;
                    trigNode._pinned = false;
                    flayout.start();
                  }},
                show_label: {
                  name: "Show Label",
                  visible: !trigNode._label_visible,
                  callback: function(key, options) {
                    trigNode.label_visible = true;
                  }},
                hide_label: {
                  name: "Hide Label",
                  visible: trigNode._label_visible,
                  callback: function(key, options) {
                    trigNode.label_visible = false;
                  }},
                fold2: {
                    name: "Select",
                    items: {
                    select: {
                        name: "Cluster",
                        callback: function(key, options) {
                          graph.update_selected(function(d) {
                            if(d._curr_group == trigNode._curr_group) {
                              return true;
                            }
                          });
                    }},
                    invert: {
                        name: 'Invert',
                        callback: function(key, options) {
                          graph.update_selected(function(d) {
                            return !d.selected;
                          });
                    }},
                    none: {
                        name: 'None',
                        callback: function(key, options) {
                          graph.update_selected(function(d) {
                            return false;
                          });
                    }},
                    strain: {
                        name: 'Strain',
                        callback: function(key, options) {
                          graph.update_selected(function(d) {
                              if(d.group === trigNode.group) {
                                return true;
                              }

                              return d.selected;
                          });
                    }},
                    node: {
                        name: "Node",
                        callback: function(key, options) {
                          trigNode.selected = !trigNode.selected;
                    }}
                }},
                fold3: {
                    name: "Set Emphasis",
                    items: {
                    highlight: {
                        name: "Highlight",
                        callback: function(key, options) {
                          graph.samples.forEach(function(el, idx) {
                              if(el._curr_group == trigNode._curr_group) {
                                el._push_out = false;
                                el._dim = false;
                              }
                          });
                          reset_highlight();
                    }},
                    downplay: {
                        name: "Downplay",
                        callback: function(key, options) {
                          graph.samples.forEach(function(el, idx) {
                              if(el._curr_group == trigNode._curr_group) {
                                el._push_out = true;
                                el._dim = true;
                              }
                          });
                          reset_highlight();
                    }},
                    spotlight: {
                        name: "Spotlight",
                        callback: function(key, options) {
                          graph.samples.forEach(function(el, idx) {
                              if(el._curr_group == trigNode._curr_group) {
                                el._push_out = false;
                                el._dim = false;
                              } else {
                                el._push_out = true;
                                el._dim = true;
                              }
                          });
                          reset_highlight();
                    }},
                    reset_highlight: {
                      name: "Reset Highlight",
                        callback: function(key, options) {
                          graph.samples.forEach(function(el, idx) {
                              el._dim = false;
                              el._push_out = el.group < 1;
                          });
                          reset_highlight();
                      }},
                    hide_cluster: {
                        name: "Hide",
                        callback: function(key, options) {
                          graph.active(function(d) {
                            return d._curr_group != trigNode._curr_group;
                          });
                      }},
                    hide_others: {
                        name: 'Hide Others',
                        callback: function(key, options) {
                          graph.active(function(el, idx) {
                              return el._curr_group == trigNode._curr_group;
                          });
                      }}
                    },
                },
            }};
        }
      });
    });
  </script>
</body>
